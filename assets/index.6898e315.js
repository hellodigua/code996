var W=Object.defineProperty,q=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var N=(t,e,o)=>e in t?W(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,C=(t,e)=>{for(var o in e||(e={}))I.call(e,o)&&N(t,o,e[o]);if(T)for(var o of T(e))j.call(e,o)&&N(t,o,e[o]);return t},S=(t,e)=>q(t,H(e));import{u as D}from"./vendor.72506aeb.js";import{_ as U,i as m,r as z}from"./index.337d73e0.js";const O=Vue.defineComponent({props:{data:{type:Array,default:()=>[]},chartType:{type:String,required:!0},options:{type:Object,default:()=>({backgroundColor:"#212121",strokeColor:"#fff"})}},setup(t,{expose:e}){const o=t,n=Vue.ref(null);let r=null;function l(){if(!n.value)return;const u=chartXkcd[o.chartType];if(!u){console.error(`\u56FE\u8868\u7C7B\u578B ${o.chartType} \u4E0D\u5B58\u5728`);return}r=new u(n.value,{data:{labels:o.data.map(i=>i.time),datasets:[{data:o.data.map(i=>i.count)}]},options:o.options})}return Vue.onMounted(()=>{Vue.nextTick(()=>{l()})}),e({chartInstance:r}),(u,i)=>(Vue.openBlock(),Vue.createElementBlock("svg",{class:"chart",ref_key:"chartRef",ref:n},null,512))}});var x=U(O,[["__scopeId","data-v-27860bf5"]]);const B=Vue.defineComponent({props:{data:{type:Array,default:()=>[]}},setup(t){const e={backgroundColor:"#212121",strokeColor:"#fff",unxkcdify:!1};return(o,n)=>(Vue.openBlock(),Vue.createBlock(x,{data:t.data,chartType:"Bar",options:e},null,8,["data"]))}}),R=Vue.defineComponent({props:{data:{type:Array,default:()=>[]}},setup(t){const e={backgroundColor:"#212121",strokeColor:"#fff"};return(o,n)=>(Vue.openBlock(),Vue.createBlock(x,{data:t.data,chartType:"Pie",options:e},null,8,["data"]))}});function F(t){const{openingTime:e,closingTime:o}=G(t),{workHourPl:n}=Y(t,e);return{openingTime:e,closingTime:o,workHourPl:n}}function G(t){const e=t.reduce((a,s)=>a+s.count**2,0)/t.length,o=Math.sqrt(e),r=t.map((a,s)=>{var c,V;const p=a.count/o;return S(C({},a),{score:p,prevScore:(a.count-(((c=t[s-1])==null?void 0:c.count)||a.count))/o,nextScore:((((V=t[s+1])==null?void 0:V.count)||a.count)-a.count)/o})}).filter(a=>a.score>=.45),l=r.filter(a=>+a.time>=8&&+a.time<=12),u=r.filter(a=>+a.time>=17&&+a.time<=23),i=l.sort((a,s)=>Number(a.time)-Number(s.time))[0],d=u.sort((a,s)=>Number(s.time)-Number(a.time))[0];return{openingTime:i,closingTime:d}}function Y(t=[],e){const o=t.filter(c=>+c.time>=+(e==null?void 0:e.time)&&+c.time<=+(e==null?void 0:e.time)+9),n=t.filter(c=>!o.includes(c)),r=o.reduce((c,V)=>c+V.count,0),l=n.reduce((c,V)=>c+V.count,0),u=t.sort((c,V)=>V.count-c.count),i=u.slice(0,9),d=u.slice(9,u.length+1),a=i.reduce((c,V)=>c+V.count,0),s=d.reduce((c,V)=>c+V.count,0);return{workHourPl:[{time:m.global.t("result.chartLabels.work"),count:r,timeCount:i.length},{time:m.global.t("result.chartLabels.overtime"),count:l,timeCount:d.length}],workingTimeCount:r,workingElseTimeCount:l,top9TimeCount:a,top9ElseTimeCount:s}}function $(t){return t.reduce((e,o)=>e+o.count,0)}function b(t,e,o=2){return+(t/e*100).toFixed(o)}function _(t=[]){return t[Math.floor(Math.random()*t.length)]}function P(t){const e=t.slice(0,5),o=t[5],n=t[6],r=$(t),l={workday:$(e),saturday:o.count,sunday:n.count},u={workday:b(l.workday,r),saturday:b(l.saturday,r),sunday:b(l.sunday,r)},i=[{time:m.global.t("result.timeLabels.workday"),count:l.workday},{time:m.global.t("result.timeLabels.weekend"),count:l.saturday+l.sunday}],d=Q(u),s=[5,6,6,7,7][d-1];return{totalCount:r,commitCount:l,commitRatio:u,workDayType:d,workDayTypeValue:s,workWeekPl:i}}function Q(t){let e=1;return t.workday>=90?e=1:t.workday>=85&&t.workday<90?e=2:t.workday>=79&&t.workday<85?e=3:t.workday>=72&&t.workday<79?e=4:t.workday<72&&(e=5),e}function A(t=""){if(!t)return console.warn("\u89E3\u6790\u7684URL\u53C2\u6570\u4E3A\u7A7A"),[];let e=[];try{t.split(",").forEach(o=>{if(!o.includes("_")){console.warn(`\u65E0\u6548\u7684\u683C\u5F0F: ${o}\uFF0C\u5E94\u4E3A 'count_time'`);return}const n=o.split("_");if(n.length!==2){console.warn(`\u65E0\u6548\u7684\u683C\u5F0F: ${o}\uFF0C\u5E94\u4E3A 'count_time'`);return}const r=Number(n[0]);if(isNaN(r)){console.warn(`\u65E0\u6548\u7684\u6570\u91CF\u503C: ${n[0]}`);return}e.push({time:n[1],count:r})})}catch(o){console.error("\u89E3\u6790URL\u53C2\u6570\u65F6\u51FA\u9519:",o)}return e}function X(t){return Array.isArray(t)?[{name:m.global.t("result.weekdays.monday"),key:"1"},{name:m.global.t("result.weekdays.tuesday"),key:"2"},{name:m.global.t("result.weekdays.wednesday"),key:"3"},{name:m.global.t("result.weekdays.thursday"),key:"4"},{name:m.global.t("result.weekdays.friday"),key:"5"},{name:m.global.t("result.weekdays.saturday"),key:"6"},{name:m.global.t("result.weekdays.sunday"),key:"7"}].map(o=>{const n=t.find(r=>r.time===o.key);return{time:o.name,count:(n==null?void 0:n.count)||0}}):(console.warn("parseWeekData: \u8F93\u5165\u4E0D\u662F\u6570\u7EC4"),[])}function J(){const t=VueRouter.useRouter(),{query:e}=t.currentRoute.value,n=["time","hour","week"].filter(l=>!e[l]);if(n.length>0){console.error(`\u7F3A\u5C11\u5FC5\u8981\u7684URL\u53C2\u6570: ${n.join(", ")}`),t.push({name:"index",query:{error:"url_query_error",missing:n.join(",")}});return}const r=e.time;(!r.includes("_")||r.split("_").length!==2)&&(console.error("\u65E0\u6548\u7684\u65F6\u95F4\u53C2\u6570\u683C\u5F0F"),t.push({name:"index",query:{error:"invalid_time_format"}}))}function w(){const t=VueRouter.useRouter(),{query:e}=t.currentRoute.value,o=A(e.hour),n=X(A(e.week)),r=e.time.split("_"),l=`${r[0]} \u223C ${r[1]}`,u=o.reduce((i,d)=>i+d.count,0);return{hourData:o,weekData:n,timeRange:r,timeStr:l,totalCount:u}}function K(){const{hourData:t,weekData:e,totalCount:o}=w(),{openingTime:n,closingTime:r,workHourPl:l}=F(t),{workDayTypeValue:u,workWeekPl:i}=P(e),{index996:d,index996Str:a,overTimeRadio:s,isStandard:p}=L({workHourPl:l,workWeekPl:i,hourData:t}),c=ee({workHourPl:l,workWeekPl:i,index996:d,overTimeRadio:s}),V=Number(n==null?void 0:n.time),k=Number(r==null?void 0:r.time)%12;return{workingType:`${V||"?"}${k||"?"}${u||"?"}`,workingTypeStr:m.global.t("result.workingTypeTemplate",{start:V||"?",end:k||"?",days:u||"?"}),openingTime:n,closingTime:r,workDayTypeValue:u,workHourPl:l,workWeekPl:i,totalCount:o,index996:d,index996Str:a,overTimeRadio:s,isStandard:p,MSG_TYPE:c}}function L({workHourPl:t,workWeekPl:e,hourData:o}){const n=t[0].count,r=t[1].count,l=e[0].count,u=e[1].count,i=Math.round(r+n*u/(l+u)),d=n+r;let a=Math.ceil(i/d*100);a===0&&o.length<9&&(a=Z({hourData:o,totalCount:d}));const s=a*3,p=s<200&&d>50;let c="";const V=m.global.locale.value,k=m.global.messages.value[V];return s<=10?c=_(k.result.index996Descriptions.excellent):s>10&&s<=50?c=_(k.result.index996Descriptions.good):s>50&&s<=90?c=_(k.result.index996Descriptions.medium):s>90&&s<=110?c=_(k.result.index996Descriptions.bad):s>110&&(c=_(k.result.index996Descriptions.terrible)),{index996:s,index996Str:c,overTimeRadio:a,isStandard:p}}function Z({hourData:t,totalCount:e}){const n=e/t.length*9;return Math.ceil(e/n*100)-100}function ee(t){const{workHourPl:e,workWeekPl:o}=t;let n="";const r=e[0].count+e[1].count,l=o[0].count+o[1].count;return r!==l&&(n="commit_is_fake"),n}function te(){const{hourData:t,weekData:e}=w(),{openingTime:o,closingTime:n,workHourPl:r}=F(t),{workDayTypeValue:l,workWeekPl:u}=P(e),{index996:i,overTimeRadio:d,isStandard:a}=L({workHourPl:r,workWeekPl:u,hourData:t}),s=Number(o==null?void 0:o.time),p=Number(n==null?void 0:n.time),c=[{label:m.global.t("result.table.dailyWorkTime"),key:"codeTime",unit:"h"},{label:m.global.t("result.table.weeklyWorkTime"),key:"weekTime",unit:"h"},{label:m.global.t("result.table.weeklyOvertime"),key:"overtime",unit:"h"},{label:m.global.t("result.table.overtimeRatio"),key:"overTimeRadio",unit:"%"},{label:m.global.t("result.table.index996"),key:"index996",unit:""}],V=p-s;let k=0;p<=19?k=p-s-1.5:p>19&&(k=p-s-2.5);const f=k*l,g=(d*.01*f).toFixed(1),h={type:`${s||"?"}${p%12||"?"}${l||"?"}`,attendance:V,codeTime:k,weekTime:f,overtime:g,overTimeRadio:d,index996:i};let y=[{type:"955",attendance:8,codeTime:6.5,weekTime:32.5,overtime:-5,overTimeRadio:-11,index996:-33},{type:"965",attendance:9,codeTime:7.5,weekTime:37.5,overtime:0,overTimeRadio:0,index996:0},{type:"966",attendance:9,codeTime:7.5,weekTime:45,overtime:7.5,overTimeRadio:16,index996:48},{type:"995",attendance:12,codeTime:9.5,weekTime:47.5,overtime:10,overTimeRadio:21,index996:63},{type:"996",attendance:12,codeTime:9.5,weekTime:57,overtime:19.5,overTimeRadio:34,index996:100},{type:"997",attendance:12,codeTime:9.5,weekTime:66.5,overtime:29,overTimeRadio:44,index996:130},{type:"9126",attendance:15,codeTime:12.5,weekTime:75,overtime:37.5,overTimeRadio:50,index996:150}];return a&&(y=[...y,h].sort((v,E)=>v.index996-E.index996)),{tableConfig:c,tableData:y,index996:i,isStandard:a}}const oe={class:"table-box"},ne={class:"container table"},ue={class:"l"},re={class:"l"},ae={class:"tips"},se=Vue.defineComponent({setup(t){const{t:e}=D(),{tableConfig:o,tableData:n,index996:r,isStandard:l}=te(),u=i=>r===i&&l?"active":"";return(i,d)=>(Vue.openBlock(),Vue.createElementBlock("div",oe,[Vue.createElementVNode("table",ne,[Vue.createElementVNode("thead",null,[Vue.createElementVNode("tr",null,[Vue.createElementVNode("th",ue,Vue.toDisplayString(Vue.unref(e)("result.table.timeType")),1),(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(n),a=>(Vue.openBlock(),Vue.createElementBlock("th",{class:Vue.normalizeClass(u(a.index996))},Vue.toDisplayString(a.type),3))),256))])]),Vue.createElementVNode("tbody",null,[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(o),a=>(Vue.openBlock(),Vue.createElementBlock("tr",null,[Vue.createElementVNode("td",re,Vue.toDisplayString(a.label),1),(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(n),s=>(Vue.openBlock(),Vue.createElementBlock("td",{class:Vue.normalizeClass(u(s.index996))},Vue.toDisplayString(s[a.key])+Vue.toDisplayString(a.unit),3))),256))]))),256))])]),Vue.createElementVNode("p",ae,Vue.toDisplayString(Vue.unref(e)("result.table.highlightTip")),1)]))}}),le={class:"result"},ce={class:"top-bar"},ie={class:"wrapper"},de={class:"main wrapper"},Ve={class:"top-result container"},me={key:0},pe={class:"result-line"},ke={key:0,class:"score-box"},ye={class:"score-number"},_e={class:"content"},fe={key:0},ge={class:"p1"},he={class:"p2"},ve={key:1},Ee={class:"p1"},be={key:0,class:"p2"},we={key:2},Te={key:0},Ne={key:1},Ce={class:"p1"},Se={class:"p1"},De={key:1,class:"exp"},xe={class:"content container"},Be={class:"section"},Re={class:"item"},Fe={key:0,class:"item"},$e={class:"section"},Pe={class:"item"},Ae={key:0,class:"item"},Le={id:"compare-table"},Me={class:"container"},We={class:"title"},je=Vue.defineComponent({setup(t){const{t:e}=D(),o=Vue.ref([]),n=Vue.ref([]),r=Vue.ref([]),l=Vue.ref([]),u=Vue.ref({});function i(){const{hourData:s,weekData:p,timeStr:c,totalCount:V}=w(),{workingType:k,workingTypeStr:f,index996:g,index996Str:h,overTimeRadio:y,isStandard:v,workHourPl:E,workWeekPl:M}=K();o.value=[...s],n.value=[...p],r.value=[...E],l.value=[...M],u.value={workingType:k,workingTypeStr:f,totalCount:V,timeStr:c,index996:g,index996Str:h,overTimeRadio:y,isStandard:v}}const d=()=>{const s=document.getElementById("compare-table");s&&s.scrollIntoView({behavior:"smooth"})},a=()=>{const p=m.global.locale.value==="zh-CN"?"zh-index":"en-index";z.push({name:p})};return J(),Vue.onMounted(()=>{i()}),(s,p)=>(Vue.openBlock(),Vue.createElementBlock("div",le,[Vue.createElementVNode("div",ce,[Vue.createElementVNode("div",ie,[Vue.createElementVNode("span",{class:"button back",onClick:a},Vue.toDisplayString(Vue.unref(e)("common.back")),1),Vue.createElementVNode("h1",null,Vue.toDisplayString(Vue.unref(e)("nav.title")),1)])]),Vue.createElementVNode("div",de,[Vue.createElementVNode("div",Ve,[u.value.isStandard?(Vue.openBlock(),Vue.createElementBlock("h1",me,Vue.toDisplayString(Vue.unref(e)("result.title")),1)):Vue.createCommentVNode("",!0),Vue.createElementVNode("div",pe,[u.value.isStandard?(Vue.openBlock(),Vue.createElementBlock("div",ke,[Vue.createElementVNode("div",ye,Vue.toDisplayString(u.value.index996),1)])):Vue.createCommentVNode("",!0),Vue.createElementVNode("div",_e,[u.value.isStandard?(Vue.openBlock(),Vue.createElementBlock("p",fe,[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(e)("result.workingType"))+" ",1),Vue.createElementVNode("span",ge,Vue.toDisplayString(u.value.workingType),1),Vue.createElementVNode("span",he,"("+Vue.toDisplayString(u.value.workingTypeStr)+")",1)])):Vue.createCommentVNode("",!0),u.value.isStandard?(Vue.openBlock(),Vue.createElementBlock("p",ve,[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(e)("result.overtimeRatio"))+" ",1),Vue.createElementVNode("span",Ee,Vue.toDisplayString(u.value.overTimeRadio)+"%",1),u.value.index996<0?(Vue.openBlock(),Vue.createElementBlock("span",be,Vue.toDisplayString(Vue.unref(e)("result.notSaturated")),1)):Vue.createCommentVNode("",!0)])):Vue.createCommentVNode("",!0),u.value.isStandard?Vue.createCommentVNode("",!0):(Vue.openBlock(),Vue.createElementBlock("p",we,[u.value.totalCount<=50?(Vue.openBlock(),Vue.createElementBlock("span",Te,Vue.toDisplayString(Vue.unref(e)("result.lowCommit")),1)):(Vue.openBlock(),Vue.createElementBlock("span",Ne,Vue.toDisplayString(Vue.unref(e)("result.openSource")),1))])),Vue.createElementVNode("p",null,[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(e)("result.totalCommits"))+" ",1),Vue.createElementVNode("span",Ce,Vue.toDisplayString(u.value.totalCount),1)]),Vue.createElementVNode("p",null,[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(e)("result.analysisTime"))+" ",1),Vue.createElementVNode("span",Se,Vue.toDisplayString(u.value.timeStr),1)])])]),u.value.isStandard?(Vue.openBlock(),Vue.createElementBlock("p",De,[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(e)("result.indexExplanation"))+" ",1),Vue.createElementVNode("a",{onClick:d},Vue.toDisplayString(Vue.unref(e)("result.seeTable")),1)])):Vue.createCommentVNode("",!0)]),Vue.createElementVNode("div",xe,[Vue.createElementVNode("div",Be,[Vue.createElementVNode("div",Re,[Vue.createElementVNode("h2",null,Vue.toDisplayString(Vue.unref(e)("result.charts.hourDistribution")),1),Vue.createVNode(B,{data:o.value},null,8,["data"])]),u.value.isStandard?(Vue.openBlock(),Vue.createElementBlock("div",Fe,[Vue.createElementVNode("h2",null,Vue.toDisplayString(Vue.unref(e)("result.charts.hourRatio")),1),Vue.createVNode(R,{data:r.value},null,8,["data"])])):Vue.createCommentVNode("",!0)]),Vue.createElementVNode("div",$e,[Vue.createElementVNode("div",Pe,[Vue.createElementVNode("h2",null,Vue.toDisplayString(Vue.unref(e)("result.charts.dayDistribution")),1),Vue.createVNode(B,{data:n.value},null,8,["data"])]),u.value.isStandard?(Vue.openBlock(),Vue.createElementBlock("div",Ae,[Vue.createElementVNode("h2",null,Vue.toDisplayString(Vue.unref(e)("result.charts.dayRatio")),1),Vue.createVNode(R,{data:l.value},null,8,["data"])])):Vue.createCommentVNode("",!0)])]),Vue.createElementVNode("h2",Le,Vue.toDisplayString(Vue.unref(e)("result.compareTable")),1),Vue.createVNode(se),Vue.createElementVNode("div",Me,[Vue.createElementVNode("h2",We,Vue.toDisplayString(Vue.unref(e)("result.notice.title")),1),Vue.createElementVNode("p",null,Vue.toDisplayString(Vue.unref(e)("result.notice.point1")),1),Vue.createElementVNode("p",null,Vue.toDisplayString(Vue.unref(e)("result.notice.point2")),1),Vue.createElementVNode("p",null,Vue.toDisplayString(Vue.unref(e)("result.notice.point3")),1)])])]))}});export{je as default};
